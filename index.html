<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='90' font-size='90'>ðŸª´</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Compost | Ron Majiros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617; 
            --card-bg: #0f172a; 
            --accent: #38bdf8;
            --text-main: #f8fafc; 
            --text-muted: #94a3b8;
        }
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #020617 !important; /* Forced Deep Slate */
            color: #f8fafc !important; /* Forced Bright White */
        }
        .mono {
            font-family: 'JetBrains Mono', monospace;
        }
        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 3;
        }
        .prose h1, .prose h2, .prose h3 { color: white !important; font-weight: 800; margin-top: 1.5rem; margin-bottom: 0.75rem; }
        .prose p { margin-bottom: 1rem; line-height: 1.6; color: #cbd5e1 !important; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .prose a { color: #38bdf8 !important; text-decoration: underline; }
        
        .hero-gradient {
            background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.05), transparent);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        
        /* Ensure all links are visible */
        a { transition: all 0.2s; }
        a:hover { filter: brightness(1.2); }
    </style>
</head>
<body class="min-h-screen hero-gradient text-slate-50">

    <div class="max-w-7xl mx-auto px-4 py-12 md:py-20">
        <!-- Header -->
        <header class="text-center mb-20">
            <div class="inline-block px-3 py-1 mb-4 rounded-full bg-sky-500/10 border border-sky-500/20 text-sky-400 text-sm font-semibold tracking-wider uppercase mono">
                Nashville to the Sea
            </div>
            <h1 class="text-5xl md:text-7xl font-black text-white mb-6 tracking-tight">
                Digital <span class="text-sky-400 italic">Compost</span>
            </h1>
            <p class="text-xl text-slate-300 max-w-3xl mx-auto font-light leading-relaxed">
                A place for raw ideas to break down, cross-pollinate, and become fertile. Navigating the intersection of Music Row and the Great Loop.
            </p>
        </header>

        <!-- Odyssey News Section -->
        <section id="news-section" class="mb-24">
            <div class="flex items-end justify-between mb-10 border-b border-slate-800 pb-4">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-1">Latest News</h2>
                    <p class="text-slate-400">Updates from the Great Loop and beyond.</p>
                </div>
                <div class="text-sky-400 text-sm mono">01 â€” LATEST</div>
            </div>
            <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
            </div>
        </section>

        <!-- Notes Section -->
        <section id="notes-section" class="mb-24">
            <div class="flex items-end justify-between mb-10 border-b border-slate-800 pb-4">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-1">Notes & Articles</h2>
                    <p class="text-slate-400">Deep dives into business, life, and the sea.</p>
                </div>
                <div class="text-sky-400 text-sm mono">02 â€” ARCHIVE</div>
            </div>
            <div id="notes-container" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            </div>
        </section>

        <!-- Feeds Wrapper -->
        <div id="feeds-wrapper" class="space-y-24"></div>

        <!-- YouTube Section -->
        <section id="youtube-section" class="mt-24">
            <div class="flex items-end justify-between mb-10 border-b border-slate-800 pb-4">
                <div>
                    <h2 class="text-3xl font-bold text-white mb-1">Villa Vie YouTube</h2>
                    <p class="text-slate-400">Visual dispatches from the water.</p>
                </div>
                <div class="text-sky-400 text-sm mono">03 â€” VIDEO</div>
            </div>
            <div id="youtube-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="max-w-7xl mx-auto px-4 py-20 border-t border-slate-800 flex flex-col md:flex-row justify-between items-center text-slate-500 text-sm">
        <div class="mb-6 md:mb-0">
            &copy; 2026 Ron Majiros. All rights reserved. Built with precision in Nashville.
        </div>
        <div class="flex space-y-4 md:space-y-0 md:space-x-8 flex-col md:flex-row items-center">
            <a href="https://majiros.com" target="_blank" class="hover:text-white transition-colors">majiros.com</a>
            <a href="https://airtable.com/apphdYcfXWC3ryCTK/pagzFlotY1WrGQkcH" target="_blank" class="px-4 py-2 rounded-lg bg-sky-500/10 border border-sky-500/20 text-sky-400 hover:bg-sky-500 hover:text-white transition-all font-semibold">
                Add Fertilizer
            </a>
        </div>
    </footer>

    <!-- Fullscreen Modal -->
    <div id="fullscreen-modal" class="fixed inset-0 bg-black/95 backdrop-blur-xl flex justify-center items-center p-4 md:p-10 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="relative w-full h-full max-w-5xl bg-slate-900 rounded-3xl shadow-2xl border border-slate-800 flex flex-col overflow-hidden">
            <div class="p-4 md:p-6 border-b border-slate-800 flex justify-between items-center shrink-0">
                <div id="modal-date" class="text-xs mono text-sky-400 uppercase tracking-widest"></div>
                <button id="modal-close" class="p-2 hover:bg-slate-800 rounded-full transition-colors text-white text-2xl leading-none">
                    &times;
                </button>
            </div>
            <div class="p-8 md:p-16 overflow-y-auto grow custom-scrollbar">
                <h2 id="modal-title" class="text-4xl md:text-5xl font-black text-white mb-8 leading-tight"></h2>
                <div id="modal-content" class="prose prose-invert max-w-none text-slate-200"></div>
            </div>
        </div>
    </div>

    <script type="module">
        const newsContainer = document.getElementById('news-container');
        const notesContainer = document.getElementById('notes-container');
        const feedsWrapper = document.getElementById('feeds-wrapper');
        const youtubeContainer = document.getElementById('youtube-container');
        const modal = document.getElementById('fullscreen-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalDate = document.getElementById('modal-date');
        const modalClose = document.getElementById('modal-close');

        marked.setOptions({ breaks: true, gfm: true });

        function showNoteModal(title, content, date = '') {
            modalTitle.textContent = title;
            modalContent.innerHTML = marked.parse(content || '');
            modalDate.textContent = date;
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.add('opacity-100'), 10);
            document.body.style.overflow = 'hidden';
        }

        function hideNoteModal() {
            modal.classList.remove('opacity-100');
            setTimeout(() => modal.classList.add('hidden'), 300);
            document.body.style.overflow = 'auto';
        }

        modalClose.addEventListener('click', hideNoteModal);
        modal.addEventListener('click', (e) => {
            if (e.target.id === 'fullscreen-modal') hideNoteModal();
        });

        async function loadContent() {
            try {
                const newsResp = await fetch('/api/news');
                if (newsResp.ok) {
                    const news = await newsResp.json();
                    newsContainer.innerHTML = '';
                    news.forEach(item => {
                        const card = document.createElement('div');
                        card.className = 'group cursor-pointer bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 hover:border-sky-500 transition-all';
                        const displayImage = item.image || '/assets/nashville-to-sea.png';
                        card.innerHTML = `
                            <div class="aspect-video overflow-hidden bg-black">
                                <img src="${displayImage}" alt="${item.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 opacity-80 group-hover:opacity-100">
                            </div>
                            <div class="p-6">
                                <div class="text-xs mono text-sky-400 mb-3">${item.published || 'RECENT'}</div>
                                <h3 class="text-2xl font-bold text-white mb-3 group-hover:text-sky-400 transition-colors">${item.title}</h3>
                                <div class="text-slate-400 text-sm line-clamp-3 mb-4 leading-relaxed">${item.content ? item.content.substring(0, 200) + '...' : ''}</div>
                                <div class="flex items-center text-sky-400 font-semibold text-sm">READ MORE 
                                    <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                                </div>
                            </div>
                        `;
                        card.onclick = () => showNoteModal(item.title, item.content, item.published);
                        newsContainer.appendChild(card);
                    });
                }

                const notesResp = await fetch('/api/notes');
                if (notesResp.ok) {
                    const allNotes = await notesResp.json();
                    const notes = allNotes.filter(n => n.status === 'Published');
                    notesContainer.innerHTML = '';
                    notes.forEach(note => {
                        const card = document.createElement('div');
                        card.className = 'p-6 bg-slate-900 rounded-xl border border-slate-800 hover:bg-slate-800 transition-all cursor-pointer group';
                        card.innerHTML = `
                            <h3 class="text-lg font-bold text-white mb-2 group-hover:text-sky-400 transition-colors">${note.title}</h3>
                            <div class="text-slate-400 text-sm line-clamp-3 font-light">${note.content || ''}</div>
                        `;
                        card.onclick = () => showNoteModal(note.title, note.content);
                        notesContainer.appendChild(card);
                    });
                }

                const feedsResp = await fetch('/api/get-content');
                if (feedsResp.ok) {
                    const data = await feedsResp.json();
                    const feedKeys = ['villaVie', 'residentialCruising'];
                    feedKeys.forEach(key => {
                        if (!data.feeds[key]) return;
                        const section = document.createElement('section');
                        const title = key === 'villaVie' ? 'Villa Vie Odyssey' : 'Residential Cruising';
                        section.innerHTML = `
                            <div class="flex items-end justify-between mb-10 border-b border-slate-800 pb-4">
                                <div><h2 class="text-3xl font-bold text-white mb-1">${title}</h2><p class="text-slate-400">Web alerts and dispatches.</p></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${data.feeds[key].map(item => `
                                    <a href="${item.link}" target="_blank" class="p-6 bg-slate-900 rounded-xl border border-slate-800 hover:border-sky-500/30 transition-all group">
                                        <h3 class="font-bold text-white mb-2 line-clamp-2 group-hover:text-sky-400 transition-colors">${item.title}</h3>
                                        <div class="text-slate-400 text-xs line-clamp-3 font-light">${item.contentSnippet || item.summary || ''}</div>
                                    </a>
                                `).join('')}
                            </div>
                        `;
                        feedsWrapper.appendChild(section);
                    });

                    youtubeContainer.innerHTML = data.youtube.map(video => `
                        <a href="https://www.youtube.com/watch?v=${video.id.videoId}" target="_blank" class="group bg-slate-900 rounded-2xl overflow-hidden border border-slate-800 hover:border-sky-500/50 transition-all">
                            <img src="${video.snippet.thumbnails.high.url}" class="w-full aspect-video object-cover opacity-70 group-hover:opacity-100 transition-all duration-500">
                            <div class="p-4">
                                <h3 class="font-bold text-white mb-1 line-clamp-2">${video.snippet.title}</h3>
                                <p class="text-slate-500 text-xs mono uppercase">${video.snippet.channelTitle}</p>
                            </div>
                        </a>
                    `).join('');
                }
            } catch (err) { console.error(err); }
        }

        document.addEventListener('DOMContentLoaded', loadContent);
    </script>
</body>
</html>
